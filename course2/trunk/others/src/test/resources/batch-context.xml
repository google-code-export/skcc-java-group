<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://www.springframework.org/schema/batch"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.1.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd">
	<beans:import resource="classpath:datasource-context.xml"/>
	<job-repository id="jobRepository" data-source="dataSource" transaction-manager="transactionManager"/>
	
	<job id="insertUserBatch" job-repository="jobRepository">
		<step id="step3">
			<tasklet>
				<chunk reader="csvFileReader" writer="jdbcItemWriter" commit-interval="5"/>
			</tasklet>
		</step>
	</job>
	
	<beans:bean id="csvFileReader" class="org.springframework.batch.item.file.FlatFileItemReader">
		<beans:property name="resource" value="classspath:users.csv"/>
		<beans:property name="lineMapper">
			<beans:bean class="org.springframework.batch.item.file.mapping.DefaultLineMapper">
				<beans:property name="lineTokenizer">
					<beans:bean class="org.springframework.batch.item.file.transform.DelimitedLineTokenizer" p:delimiter="," p:names="username,password"></beans:bean>
				</beans:property>
				<beans:property name="fieldSetMapper">
					<beans:bean class="org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper" p:targetType="com.skcc.tutorial.batch.User"/>
				</beans:property>
			</beans:bean>
		</beans:property>
	</beans:bean>
	
	<beans:bean id="jdbcItemWriter" class="org.springframework.batch.item.database.IbatisBatchItemWriter" 
		p:assertUpdates="true" p:sqlMapClient-ref="sqlMapClient" p:statementId="insertUser"/>

	<task:annotation-driven executor="myExecutor" scheduler="myScheduler"/>
	<task:executor id="myExecutor" pool-size="5"/>
	<task:scheduler id="myScheduler" pool-size="10"/>
		
</beans:beans>
